{% extends "base.html" %}
{% load static %}

{% block title %}Image Plagiarism Results{% endblock %}

{% block content %}
<!-- Result Modal -->
<div id="resultModal" class="modal-overlay" style="display: none;">
  <div class="modal-content animate-pop-in">
    <div class="modal-header">
      <h3 id="modalTitle">Analysis Complete</h3>
      <button class="close-btn" onclick="closeModal()">&times;</button>
    </div>
    <div class="modal-body text-center">
      <div id="statusIcon" style="margin-bottom: 20px;"></div>
      <h2 id="resultStatus" style="margin-bottom: 10px; color: var(--primary-color);">{{ result_status }}</h2>
      <p style="font-size: 1.1rem; color: var(--text-muted); margin-bottom: 25px;">
        Histogram Comparison Score: <span style="font-weight: 700; color: var(--accent-color);">{{ score }}</span>
      </p>
      <button class="btn btn-primary" onclick="closeModal()">View Details</button>
    </div>
  </div>
</div>

<section style="display: flex; justify-content: center; padding: 40px 0;">
  <div class="card" style="width: 100%; max-width: 900px; padding: 40px;">
    <div class="text-center" style="margin-bottom: 30px;">
      <i class="fas fa-chart-pie" style="font-size: 3rem; color: var(--secondary-color);"></i>
      <h2 style="color: var(--primary-color); margin-top: 15px;">Analysis Results</h2>
      <p style="color: var(--text-muted);">Image Plagiarism Detection Complete</p>
    </div>

    <div style="overflow-x: auto; margin-bottom: 30px;">
      {{ data|safe }}
    </div>

    <div style="display: flex; gap: 15px; justify-content: center;">
      <a href="{% url 'UploadSuspiciousImage' %}" class="btn btn-primary">
        <i class="fas fa-redo me-2"></i> Check Another Image
      </a>
      <a href="{% url 'UserScreen' %}" class="btn btn-secondary">
        <i class="fas fa-home me-2"></i> Dashboard
      </a>
    </div>
  </div>
</section>

<style>
  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(5px);
    z-index: 1000;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: white;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 450px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .close-btn {
    border: none;
    background: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-muted);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  @keyframes popIn {
    0% {
      transform: scale(0.9);
      opacity: 0;
    }

    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  .animate-pop-in {
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }
</style>

<script>
  // Show modal on load if result exists
  document.addEventListener('DOMContentLoaded', function () {
    const resultStatus = "{{ result_status }}";
    if (resultStatus) {
      const iconContainer = document.getElementById('statusIcon');
      const modal = document.getElementById('resultModal');

      if (resultStatus.includes('Plagiarism Detected') && !resultStatus.includes('No')) {
        iconContainer.innerHTML = '<i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #dc2626;"></i>';
        document.getElementById('resultStatus').style.color = '#dc2626';
      } else {
        iconContainer.innerHTML = '<i class="fas fa-check-circle" style="font-size: 4rem; color: #059669;"></i>';
        document.getElementById('resultStatus').style.color = '#059669';
      }

      modal.style.display = 'flex';
    }
  });

  function closeModal() {
    document.getElementById('resultModal').style.display = 'none';
  }
</script>
{% endblock %}