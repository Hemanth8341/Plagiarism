{% extends "base.html" %}
{% load static %}

{% block title %}Check Text Plagiarism{% endblock %}

{% block content %}
<section style="display: flex; justify-content: center; padding: 40px 0;">
    <div class="card" style="width: 100%; max-width: 800px; padding: 40px;">
        <div class="text-center" style="margin-bottom: 30px;">
            <i class="fas fa-search-plus" style="font-size: 3rem; color: var(--accent-color);"></i>
            <h2 style="color: var(--primary-color); margin-top: 15px;">Check Text Plagiarism</h2>
            <p style="color: var(--text-muted);">Upload your document to detect potential plagiarism</p>
        </div>

        <form method="post" action="{% url 'UploadSuspiciousFileAction' %}" enctype="multipart/form-data"
            id="upload-form">
            {% csrf_token %}

            <div class="upload-area" id="drop-zone"
                style="border: 2px dashed #ddd; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.2s; background: #fafafa; margin-bottom: 20px;">
                <input type="file" id="file-input" name="t1" accept=".txt" style="display: none;" required>
                <div id="upload-content">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #ccc; margin-bottom: 15px;"></i>
                    <h4 style="color: var(--text-color); margin-bottom: 5px;">Drag & Drop or Click to Upload</h4>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">Supported format: .txt (Max 5MB)</p>
                </div>
                <div id="file-info" style="display: none;">
                    <i class="fas fa-file-alt"
                        style="font-size: 3rem; color: var(--primary-color); margin-bottom: 15px;"></i>
                    <h4 id="filename-display" style="color: var(--text-color); margin-bottom: 5px;">filename.txt</h4>
                    <p style="color: var(--success-color); font-weight: 500;">File Selected</p>
                </div>
            </div>

            <div style="display: flex; gap: 15px; justify-content: center;">
                <a href="{% url 'UserScreen' %}" class="btn btn-secondary">Cancel</a>
                <button type="submit" class="btn btn-primary" style="min-width: 200px;">
                    <i class="fas fa-search me-2"></i> Analyze Text
                </button>
            </div>
        </form>

        <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
            <h4 style="color: var(--primary-color); margin-bottom: 15px;"><i class="fas fa-info-circle"></i> How It
                Works</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div>
                    <strong style="display: block; color: var(--text-color);">1. Upload</strong>
                    <span style="color: var(--text-muted); font-size: 0.9rem;">Submit your text file for
                        analysis.</span>
                </div>
                <div>
                    <strong style="display: block; color: var(--text-color);">2. Process</strong>
                    <span style="color: var(--text-muted); font-size: 0.9rem;">System tokenizes and cleans the
                        text.</span>
                </div>
                <div>
                    <strong style="display: block; color: var(--text-color);">3. Compare</strong>
                    <span style="color: var(--text-muted); font-size: 0.9rem;">LCS algorithm checks against
                        database.</span>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const uploadContent = document.getElementById('upload-content');
    const fileInfo = document.getElementById('file-info');
    const filenameDisplay = document.getElementById('filename-display');

    dropZone.addEventListener('click', () => fileInput.click());

    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = 'var(--accent-color)';
        dropZone.style.backgroundColor = 'rgba(20, 110, 180, 0.05)';
    });

    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#ddd';
        dropZone.style.backgroundColor = '#fafafa';
    });

    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#ddd';
        dropZone.style.backgroundColor = '#fafafa';

        if (e.dataTransfer.files.length) {
            fileInput.files = e.dataTransfer.files;
            updateFileInfo(e.dataTransfer.files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length) {
            updateFileInfo(e.target.files[0]);
        }
    });

    function updateFileInfo(file) {
        if (file.name.toLowerCase().endsWith('.txt')) {
            uploadContent.style.display = 'none';
            fileInfo.style.display = 'block';
            filenameDisplay.textContent = file.name;
        } else {
            alert('Please select a valid .txt file');
            fileInput.value = ''; // Reset
        }
    }
</script>
{% endblock %}